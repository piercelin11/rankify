# 前端組件遷移清單

> **目標:** 將所有調用 Server Actions 的組件改用 `useServerAction` Hook

---

## 📊 組件分類 (共 20 個)

### **高優先級 - 一般組件 (16 個)**

需要遷移至 `useServerAction`,提供統一的錯誤處理與 loading 狀態。

#### **Admin / Add Content (4 個)**
- [ ] `src/features/admin/addContent/components/AddAlbumButton.tsx`
- [ ] `src/features/admin/addContent/components/AddEPButton.tsx`
- [ ] `src/features/admin/addContent/components/AddSingleButton.tsx`
- [ ] `src/features/admin/addContent/components/ArtistAddWizard.tsx`

#### **Admin / Edit Content (7 個)**
- [ ] `src/features/admin/editContent/components/AlbumActionDropdown.tsx`
- [ ] `src/features/admin/editContent/components/AlbumEditingForm.tsx`
- [ ] `src/features/admin/editContent/components/ArtistActionDropdown.tsx`
- [ ] `src/features/admin/editContent/components/ArtistEditingForm.tsx`
- [ ] `src/features/admin/editContent/components/SortableTracksTable.tsx`
- [ ] `src/features/admin/editContent/components/TrackEditingForm.tsx`
- [ ] `src/features/admin/editContent/components/TracksTable.tsx`

#### **Admin / User (1 個)**
- [ ] `src/features/admin/user/components/UserTable.tsx`

#### **Auth (1 個)**
- [ ] `src/features/auth/components/SocialButton.tsx`

#### **Settings (2 個)**
- [ ] `src/features/settings/components/ProfileSettingsForm.tsx`
- [ ] `src/features/settings/components/RankingSettingsForm.tsx`

#### **Sorter (1 個)**
- [ ] `src/features/sorter/components/ResultStage.tsx`

---

### **低優先級 - 特殊組件 (2 個)**

這些組件使用 GET Actions (只讀資料),不需要遷移。

#### **App Routes (2 個) - GET Actions**
- ⏸️ `src/app/(main)/artist/[artistId]/album/[albumId]/page.tsx` - 使用 `getComparisonAlbumsData`
- ⏸️ `src/app/(main)/artist/[artistId]/track/[trackId]/page.tsx` - 使用 `getComparisonTracksData`

**原因:** 這兩個 Actions 是 GET 類型,已有完整錯誤處理,無需遷移。

---

### **待評估 - 複雜邏輯組件 (2 個)**

需要檢查是否已有完整的錯誤處理與 transition 邏輯。

#### **Sorter (2 個)**
- 🔍 `src/features/sorter/components/FilterStage.tsx` - 可能使用 `createSubmission`
- 🔍 `src/features/sorter/components/RankingStage.tsx` - 可能使用 `saveDraft` (throttle + localStorage)

**評估標準:**
- 如果已有完整的 transition 與錯誤處理 → 視情況決定是否遷移
- 如果只是簡單調用 → 必須遷移

---

## 🎯 遷移模式

### Before (❌ 無錯誤處理)
```typescript
const handleSubmit = async (data: FormData) => {
  const response = await updateTrack(data);
  if (response.type === "success") {
    onClose();
  }
  // 無錯誤處理、無 loading 狀態
};
```

### After (✅ 統一錯誤處理)
```typescript
import { useServerAction } from "@/lib/hooks/useServerAction";

const { execute, isPending } = useServerAction(updateTrack);
const [error, setError] = useState<string | null>(null);

const handleSubmit = async (data: FormData) => {
  setError(null);
  const result = await execute(data);

  if (result.type === "error") {
    setError(result.message);
  } else {
    toast.success(result.message);
    onClose();
  }
};

// UI 中顯示錯誤與載入狀態
{error && <p className="text-red-500">{error}</p>}
<Button disabled={isPending}>{isPending ? "處理中..." : "送出"}</Button>
```

---

## 📝 遷移順序建議

### 第一批: Admin Add Content (4 個) - 30 分鐘
簡單的按鈕操作,容易遷移。

### 第二批: Admin Edit Content (7 個) - 45 分鐘
表單操作,需要錯誤處理與 loading 狀態。

### 第三批: Settings + Admin User (3 個) - 20 分鐘
表單操作,類似 Admin Edit Content。

### 第四批: Auth + Sorter ResultStage (2 個) - 15 分鐘
特殊處理,需要仔細檢查。

### 第五批: 評估 Sorter FilterStage/RankingStage (2 個) - 30 分鐘
需要先檢查是否已有完整邏輯,再決定是否遷移。

---

## ✅ 成功指標

- [ ] 16 個高優先級組件都使用 `useServerAction`
- [ ] 所有組件都有錯誤處理 (error state 或 toast)
- [ ] 所有組件都有 loading 狀態 (isPending)
- [ ] 執行 `npm run lint` 無錯誤
- [ ] 執行 `npx tsc --noEmit` 無錯誤

---

**Generated by Claude Code** 🤖
