# å‰ç«¯çµ„ä»¶é·ç§»æ¸…å–®

> **ç›®æ¨™:** å°‡æ‰€æœ‰èª¿ç”¨ Server Actions çš„çµ„ä»¶æ”¹ç”¨ `useServerAction` Hook

---

## ğŸ“Š çµ„ä»¶åˆ†é¡ (å…± 20 å€‹)

### **é«˜å„ªå…ˆç´š - ä¸€èˆ¬çµ„ä»¶ (16 å€‹)**

éœ€è¦é·ç§»è‡³ `useServerAction`,æä¾›çµ±ä¸€çš„éŒ¯èª¤è™•ç†èˆ‡ loading ç‹€æ…‹ã€‚

#### **Admin / Add Content (4 å€‹)**
- [ ] `src/features/admin/addContent/components/AddAlbumButton.tsx`
- [ ] `src/features/admin/addContent/components/AddEPButton.tsx`
- [ ] `src/features/admin/addContent/components/AddSingleButton.tsx`
- [ ] `src/features/admin/addContent/components/ArtistAddWizard.tsx`

#### **Admin / Edit Content (7 å€‹)**
- [ ] `src/features/admin/editContent/components/AlbumActionDropdown.tsx`
- [ ] `src/features/admin/editContent/components/AlbumEditingForm.tsx`
- [ ] `src/features/admin/editContent/components/ArtistActionDropdown.tsx`
- [ ] `src/features/admin/editContent/components/ArtistEditingForm.tsx`
- [ ] `src/features/admin/editContent/components/SortableTracksTable.tsx`
- [ ] `src/features/admin/editContent/components/TrackEditingForm.tsx`
- [ ] `src/features/admin/editContent/components/TracksTable.tsx`

#### **Admin / User (1 å€‹)**
- [ ] `src/features/admin/user/components/UserTable.tsx`

#### **Auth (1 å€‹)**
- [ ] `src/features/auth/components/SocialButton.tsx`

#### **Settings (2 å€‹)**
- [ ] `src/features/settings/components/ProfileSettingsForm.tsx`
- [ ] `src/features/settings/components/RankingSettingsForm.tsx`

#### **Sorter (1 å€‹)**
- [ ] `src/features/sorter/components/ResultStage.tsx`

---

### **ä½å„ªå…ˆç´š - ç‰¹æ®Šçµ„ä»¶ (2 å€‹)**

é€™äº›çµ„ä»¶ä½¿ç”¨ GET Actions (åªè®€è³‡æ–™),ä¸éœ€è¦é·ç§»ã€‚

#### **App Routes (2 å€‹) - GET Actions**
- â¸ï¸ `src/app/(main)/artist/[artistId]/album/[albumId]/page.tsx` - ä½¿ç”¨ `getComparisonAlbumsData`
- â¸ï¸ `src/app/(main)/artist/[artistId]/track/[trackId]/page.tsx` - ä½¿ç”¨ `getComparisonTracksData`

**åŸå› :** é€™å…©å€‹ Actions æ˜¯ GET é¡å‹,å·²æœ‰å®Œæ•´éŒ¯èª¤è™•ç†,ç„¡éœ€é·ç§»ã€‚

---

### **å¾…è©•ä¼° - è¤‡é›œé‚è¼¯çµ„ä»¶ (2 å€‹)**

éœ€è¦æª¢æŸ¥æ˜¯å¦å·²æœ‰å®Œæ•´çš„éŒ¯èª¤è™•ç†èˆ‡ transition é‚è¼¯ã€‚

#### **Sorter (2 å€‹)**
- ğŸ” `src/features/sorter/components/FilterStage.tsx` - å¯èƒ½ä½¿ç”¨ `createSubmission`
- ğŸ” `src/features/sorter/components/RankingStage.tsx` - å¯èƒ½ä½¿ç”¨ `saveDraft` (throttle + localStorage)

**è©•ä¼°æ¨™æº–:**
- å¦‚æœå·²æœ‰å®Œæ•´çš„ transition èˆ‡éŒ¯èª¤è™•ç† â†’ è¦–æƒ…æ³æ±ºå®šæ˜¯å¦é·ç§»
- å¦‚æœåªæ˜¯ç°¡å–®èª¿ç”¨ â†’ å¿…é ˆé·ç§»

---

## ğŸ¯ é·ç§»æ¨¡å¼

### Before (âŒ ç„¡éŒ¯èª¤è™•ç†)
```typescript
const handleSubmit = async (data: FormData) => {
  const response = await updateTrack(data);
  if (response.type === "success") {
    onClose();
  }
  // ç„¡éŒ¯èª¤è™•ç†ã€ç„¡ loading ç‹€æ…‹
};
```

### After (âœ… çµ±ä¸€éŒ¯èª¤è™•ç†)
```typescript
import { useServerAction } from "@/lib/hooks/useServerAction";

const { execute, isPending } = useServerAction(updateTrack);
const [error, setError] = useState<string | null>(null);

const handleSubmit = async (data: FormData) => {
  setError(null);
  const result = await execute(data);

  if (result.type === "error") {
    setError(result.message);
  } else {
    toast.success(result.message);
    onClose();
  }
};

// UI ä¸­é¡¯ç¤ºéŒ¯èª¤èˆ‡è¼‰å…¥ç‹€æ…‹
{error && <p className="text-red-500">{error}</p>}
<Button disabled={isPending}>{isPending ? "è™•ç†ä¸­..." : "é€å‡º"}</Button>
```

---

## ğŸ“ é·ç§»é †åºå»ºè­°

### ç¬¬ä¸€æ‰¹: Admin Add Content (4 å€‹) - 30 åˆ†é˜
ç°¡å–®çš„æŒ‰éˆ•æ“ä½œ,å®¹æ˜“é·ç§»ã€‚

### ç¬¬äºŒæ‰¹: Admin Edit Content (7 å€‹) - 45 åˆ†é˜
è¡¨å–®æ“ä½œ,éœ€è¦éŒ¯èª¤è™•ç†èˆ‡ loading ç‹€æ…‹ã€‚

### ç¬¬ä¸‰æ‰¹: Settings + Admin User (3 å€‹) - 20 åˆ†é˜
è¡¨å–®æ“ä½œ,é¡ä¼¼ Admin Edit Contentã€‚

### ç¬¬å››æ‰¹: Auth + Sorter ResultStage (2 å€‹) - 15 åˆ†é˜
ç‰¹æ®Šè™•ç†,éœ€è¦ä»”ç´°æª¢æŸ¥ã€‚

### ç¬¬äº”æ‰¹: è©•ä¼° Sorter FilterStage/RankingStage (2 å€‹) - 30 åˆ†é˜
éœ€è¦å…ˆæª¢æŸ¥æ˜¯å¦å·²æœ‰å®Œæ•´é‚è¼¯,å†æ±ºå®šæ˜¯å¦é·ç§»ã€‚

---

## âœ… æˆåŠŸæŒ‡æ¨™

- [ ] 16 å€‹é«˜å„ªå…ˆç´šçµ„ä»¶éƒ½ä½¿ç”¨ `useServerAction`
- [ ] æ‰€æœ‰çµ„ä»¶éƒ½æœ‰éŒ¯èª¤è™•ç† (error state æˆ– toast)
- [ ] æ‰€æœ‰çµ„ä»¶éƒ½æœ‰ loading ç‹€æ…‹ (isPending)
- [ ] åŸ·è¡Œ `npm run lint` ç„¡éŒ¯èª¤
- [ ] åŸ·è¡Œ `npx tsc --noEmit` ç„¡éŒ¯èª¤

---

**Generated by Claude Code** ğŸ¤–
